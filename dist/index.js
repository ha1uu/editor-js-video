var t=[],e=[];!function(i,n){if(i&&"undefined"!=typeof document){var o,s=!0===n.prepend?"prepend":"append",d=!0===n.singleTag,a="string"==typeof n.container?document.querySelector(n.container):document.getElementsByTagName("head")[0];if(d){var l=t.indexOf(a);-1===l&&(l=t.push(a)-1,e[l]={}),o=e[l]&&e[l][s]?e[l][s]:e[l][s]=r()}else o=r();65279===i.charCodeAt(0)&&(i=i.substring(1)),o.styleSheet?o.styleSheet.cssText+=i:o.appendChild(document.createTextNode(i))}function r(){var t=document.createElement("style");if(t.setAttribute("type","text/css"),n.attributes)for(var e=Object.keys(n.attributes),i=0;i<e.length;i++)t.setAttribute(e[i],n.attributes[e[i]]);var o="prepend"===s?"afterbegin":"beforeend";return a.insertAdjacentElement(o,t),t}}(".editor-js-video-plugin {\n  display: grid;\n  grid-gap: 16px;\n}\n.editor-js-video-plugin__video {\n  display: inline-flex;\n  width: 100%;\n  height: auto;\n  position: relative;\n}\n.editor-js-video-plugin__video video {\n  width: 100%;\n  height: 100%;\n}\n.editor-js-video-plugin__video button {\n  position: absolute;\n  right: 8px;\n  top: 8px;\n  width: 26px;\n  height: 26px;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  border: none;\n  background: #e9e9e9;\n  border-radius: 5px;\n  cursor: pointer;\n}\n.editor-js-video-plugin__video button:hover {\n  background: #e2e2e2;\n}\n.editor-js-video-plugin__video button svg {\n  width: 24px;\n  height: 24px;\n}\n.editor-js-video-plugin .cdx-button {\n  position: relative;\n  width: 100%;\n}\n.editor-js-video-plugin .cdx-button input[type='file'] {\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 0;\n  height: 0;\n}\n",{});class i{rootClass="editor-js-video-plugin";title=null;video=null;headers={};uploadFileName="file";videoLoading=!1;endpoint="/";constructor({data:t,api:e,config:i}){this.title=t.title,this.video=t.video,this.api=e,i&&(i.headers&&(this.headers=i.headers),i.endpoint&&(this.endpoint=i.endpoint),i.uploadFileName&&(this.uploadFileName=i.uploadFileName))}render(){return this.root=document.createElement("div"),this.root.classList.add(this.rootClass),this.root.classList.add("cdx-block"),this.redraw(),this.root}async handleFileUpload(t){if(t.target.files[0]){let e=new FormData;return e.append(this.uploadFileName,t.target.files[0]),(await fetch(this.endpoint,{method:"POST",headers:this.headers,body:e}).then((t=>t.json()))).file}}redraw(){let t=`<label class="${this.rootClass}__upload cdx-button ${this.videoLoading?"ctx-loader":""}">\n      <input type="file" class="${this.rootClass}__hidden" accept="video/*" />\n      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 3.993C3 3.445 3.445 3 3.993 3h16.014c.548 0 .993.445.993.993v16.014a.994.994 0 0 1-.993.993H3.993A.994.994 0 0 1 3 20.007V3.993zM5 5v14h14V5H5zm5.622 3.415l4.879 3.252a.4.4 0 0 1 0 .666l-4.88 3.252a.4.4 0 0 1-.621-.332V8.747a.4.4 0 0 1 .622-.332z"/></svg>\n      <span>Добавить видео</span>\n    </label>`,e=`<div class="${this.rootClass}__video">\n      <video controls src="${this.video}"></video>\n      <button type="button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 10.586l4.95-4.95 1.414 1.414-4.95 4.95 4.95 4.95-1.414 1.414-4.95-4.95-4.95 4.95-1.414-1.414 4.95-4.95-4.95-4.95L7.05 5.636z"/></svg></button>\n    </div>`;this.root.innerHTML=`<div class="${this.rootClass}__video">${this.video?e:t}</div>\n      <input type="text" placeholder="Название видео" class="cdx-input ${this.rootClass}__title" />`;let i=this.root.querySelector(`.${this.rootClass}__title`);i.value=this.title||"",this.api.listeners.on(i,"input",(t=>{this.title=t.target.value}),!1),this.video?this.api.listeners.on(this.root.querySelector(`.${this.rootClass}__video button`),"click",(()=>{confirm("Вы уверены?")&&(this.video=null,this.redraw())}),!1):this.api.listeners.on(this.root.querySelector(`.${this.rootClass}__upload input`),"input",(t=>{this.videoLoading=!0,this.handleFileUpload(t).then((t=>{this.video=t})).catch((t=>{console.error(t.message)})).finally((()=>{this.videoLoading=!1,this.redraw()}))}),!1)}save(){return{title:this.title,video:this.video}}static get toolbox(){return{title:"Видео",icon:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 3.993C3 3.445 3.445 3 3.993 3h16.014c.548 0 .993.445.993.993v16.014a.994.994 0 0 1-.993.993H3.993A.994.994 0 0 1 3 20.007V3.993zM5 5v14h14V5H5zm5.622 3.415l4.879 3.252a.4.4 0 0 1 0 .666l-4.88 3.252a.4.4 0 0 1-.621-.332V8.747a.4.4 0 0 1 .622-.332z"/></svg>'}}}export{i as default};
//# sourceMappingURL=index.js.map
