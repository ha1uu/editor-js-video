{"version":3,"file":"index.js","sources":["../node_modules/rollup-plugin-styles/dist/runtime/inject-css.js","../src/index.js"],"sourcesContent":["var e=[],t=[];function n(n,r){if(n&&\"undefined\"!=typeof document){var a,s=!0===r.prepend?\"prepend\":\"append\",d=!0===r.singleTag,i=\"string\"==typeof r.container?document.querySelector(r.container):document.getElementsByTagName(\"head\")[0];if(d){var u=e.indexOf(i);-1===u&&(u=e.push(i)-1,t[u]={}),a=t[u]&&t[u][s]?t[u][s]:t[u][s]=c()}else a=c();65279===n.charCodeAt(0)&&(n=n.substring(1)),a.styleSheet?a.styleSheet.cssText+=n:a.appendChild(document.createTextNode(n))}function c(){var e=document.createElement(\"style\");if(e.setAttribute(\"type\",\"text/css\"),r.attributes)for(var t=Object.keys(r.attributes),n=0;n<t.length;n++)e.setAttribute(t[n],r.attributes[t[n]]);var a=\"prepend\"===s?\"afterbegin\":\"beforeend\";return i.insertAdjacentElement(a,e),e}}export{n as default};\n","import \"./index.styl\"\n\nexport default class Poll {\n  rootClass = 'editor-js-audio-plugin';\n  title = null;\n  cover = null;\n  audio = null;\n  headers = {};\n  uploadFileName = 'file';\n  imageLoading = false;\n  audioLoading = false;\n  endpoint = '/';\n  audioSvg = '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" width=\"24\" height=\"24\"><path fill=\"none\" d=\"M0 0h24v24H0z\"/><path d=\"M12 13.535V3h8v2h-6v12a4 4 0 1 1-2-3.465zM10 19a2 2 0 1 0 0-4 2 2 0 0 0 0 4z\"/></svg>';\n\n  constructor({data, api, config}){\n    this.title = data.title;\n    this.audio = data.audio;\n    this.cover = data.cover;\n    this.api = api;\n    if (config) {\n      if (config.headers) {\n        this.headers = config.headers;\n      }\n      if (config.endpoint) {\n        this.endpoint = config.endpoint;\n      }\n      if (config.uploadFileName) {\n        this.uploadFileName = config.uploadFileName;\n      }\n    }\n  }\n\n  render(){\n    this.root = document.createElement('div');\n    this.root.classList.add(this.rootClass);\n    this.root.classList.add('cdx-block');\n    this.redraw();\n    return this.root;\n  }\n\n  async handleFileUpload(e) {\n    if (e.target.files[0]) {\n      let fd = new FormData();\n      fd.append(this.uploadFileName, e.target.files[0])\n\n      let data = await fetch(this.endpoint, {\n        method: 'POST',\n        headers: this.headers,\n        body: fd\n      }).then((res) => res.json());\n\n      // let { data } = await axios.post(this.endpoint, fd, {\n      //   headers: {\n      //     'Content-Type': 'multipart/form-data',\n      //   }\n      // });\n      return data.file\n    }\n  }\n\n  redraw() {\n    let coverLabelHTML = `<label class=\"cdx-button ${this.rootClass}__cover-file\">\n      <input type=\"file\" class=\"${this.rootClass}__hidden\" accept=\"image/*\" />\n      <svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M3.15 13.628A7.749 7.749 0 0 0 10 17.75a7.74 7.74 0 0 0 6.305-3.242l-2.387-2.127-2.765 2.244-4.389-4.496-3.614 3.5zm-.787-2.303l4.446-4.371 4.52 4.63 2.534-2.057 3.533 2.797c.23-.734.354-1.514.354-2.324a7.75 7.75 0 1 0-15.387 1.325zM10 20C4.477 20 0 15.523 0 10S4.477 0 10 0s10 4.477 10 10-4.477 10-10 10z\"></path></svg>\n      <span>Добавить изображение</span>\n    </label>`\n    let coverRenderHTML = `<div class=\"${this.rootClass}__cover-image\">\n      <img alt=\"\" src=\"${this.cover || ''}\" />\n      <button type=\"button\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" width=\"24\" height=\"24\"><path fill=\"none\" d=\"M0 0h24v24H0z\"/><path d=\"M12 10.586l4.95-4.95 1.414 1.414-4.95 4.95 4.95 4.95-1.414 1.414-4.95-4.95-4.95 4.95-1.414-1.414 4.95-4.95-4.95-4.95L7.05 5.636z\"/></svg></button>\n    </div>`\n\n    let audioLabelHTML = `<label class=\"cdx-button ${this.rootClass}__audio-file  ${this.audioLoading ? 'cdx-loader' : ''}\">\n      <input type=\"file\" class=\"${this.rootClass}__hidden\" accept=\"audio/*\" />\n      ${this.audioSvg}\n      <span>${this.audio ? this.audio.split('/')[this.audio.split('/').length - 1] : 'Загрузить аудио-файл'}</span>\n    </label>`\n\n    this.root.innerHTML = `<div class=\"${this.rootClass}__cover ${this.imageLoading ? 'cdx-loader' : ''}\">${this.cover ? coverRenderHTML : coverLabelHTML}</div>\n    <div class=\"${this.rootClass}__audio\">\n      <input type=\"text\" class=\"${this.rootClass}__audio-title cdx-input\" placeholder=\"Название\" />\n      ${audioLabelHTML}\n    </div>`;\n\n    let coverContainer = this.root.querySelector(`.${this.rootClass}__cover`);\n    if (this.cover) {\n      let coverRender = coverContainer.querySelector(`.${this.rootClass}__cover-image button`);\n      this.api.listeners.on(coverRender, 'click', (e) => {\n        if (confirm(\"Вы уверены?\")) {\n          this.cover = null;\n          this.redraw();\n        }\n      }, false);\n    } else {\n      let coverInput = coverContainer.querySelector(`.${this.rootClass}__cover-file input`);\n      this.api.listeners.on(coverInput, 'input', (e) => {\n        this.imageLoading = true;\n        this.redraw();\n        this.handleFileUpload(e).then((file) => {\n          this.cover = file;\n        }).catch((e) => {\n          console.error(e.message);\n        }).finally(() => {\n          this.imageLoading = false;\n          this.redraw();\n        });\n      }, false);\n    }\n\n    let audioContainer = this.root.querySelector(`.${this.rootClass}__audio`);\n\n    let audioTitleInput = audioContainer.querySelector(`.${this.rootClass}__audio-title`);\n    audioTitleInput.value = this.title || '';\n    this.api.listeners.on(audioTitleInput, 'input', (e) => {\n      this.title = e.target.value;\n    }, false);\n\n    let audioInput = audioContainer.querySelector(`.${this.rootClass}__audio-file input`);\n    this.api.listeners.on(audioInput, 'input', (e) => {\n      this.audioLoading = true;\n      this.redraw();\n      this.handleFileUpload(e).then((file) => {\n        this.audio = file;\n      }).catch((e) => {\n        console.error(e.message);\n      }).finally(() => {\n        this.audioLoading = false;\n        this.redraw();\n      });\n    }, false);\n  }\n\n  save(){\n    return {\n      title: this.title,\n      audio: this.audio,\n      cover: this.cover,\n    };\n  }\n\n  static get toolbox() {\n    return {\n      title: 'Аудио',\n      icon: '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" width=\"24\" height=\"24\"><path fill=\"none\" d=\"M0 0h24v24H0z\"/><path d=\"M12 13.535V3h8v2h-6v12a4 4 0 1 1-2-3.465zM10 19a2 2 0 1 0 0-4 2 2 0 0 0 0 4z\"/></svg>'\n    };\n  }\n}"],"names":["e","t","n","r","document","a","s","prepend","d","singleTag","i","container","querySelector","getElementsByTagName","u","indexOf","push","c","charCodeAt","substring","styleSheet","cssText","appendChild","createTextNode","createElement","setAttribute","attributes","Object","keys","length","insertAdjacentElement","Poll","rootClass","title","cover","audio","headers","uploadFileName","imageLoading","audioLoading","endpoint","audioSvg","constructor","data","api","config","this","render","root","classList","add","redraw","async","target","files","fd","FormData","append","fetch","method","body","then","res","json","file","coverLabelHTML","coverRenderHTML","audioLabelHTML","split","innerHTML","coverContainer","coverRender","listeners","on","confirm","coverInput","handleFileUpload","catch","console","error","message","finally","audioContainer","audioTitleInput","value","audioInput","save","toolbox","icon"],"mappings":"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"}