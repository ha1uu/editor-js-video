{"version":3,"file":"index.js","sources":["../node_modules/rollup-plugin-styles/dist/runtime/inject-css.js","../src/index.js"],"sourcesContent":["var e=[],t=[];function n(n,r){if(n&&\"undefined\"!=typeof document){var a,s=!0===r.prepend?\"prepend\":\"append\",d=!0===r.singleTag,i=\"string\"==typeof r.container?document.querySelector(r.container):document.getElementsByTagName(\"head\")[0];if(d){var u=e.indexOf(i);-1===u&&(u=e.push(i)-1,t[u]={}),a=t[u]&&t[u][s]?t[u][s]:t[u][s]=c()}else a=c();65279===n.charCodeAt(0)&&(n=n.substring(1)),a.styleSheet?a.styleSheet.cssText+=n:a.appendChild(document.createTextNode(n))}function c(){var e=document.createElement(\"style\");if(e.setAttribute(\"type\",\"text/css\"),r.attributes)for(var t=Object.keys(r.attributes),n=0;n<t.length;n++)e.setAttribute(t[n],r.attributes[t[n]]);var a=\"prepend\"===s?\"afterbegin\":\"beforeend\";return i.insertAdjacentElement(a,e),e}}export{n as default};\n","import \"./index.styl\"\n\nexport default class Video {\n  rootClass = 'editor-js-video-plugin';\n  title = null;\n  video = null;\n  headers = {};\n  uploadFileName = 'file';\n  videoLoading = false;\n  endpoint = '/';\n\n  constructor({data, api, config}){\n    this.title = data.title;\n    this.video = data.video;\n    this.api = api;\n    if (config) {\n      if (config.headers) {\n        this.headers = config.headers;\n      }\n      if (config.endpoint) {\n        this.endpoint = config.endpoint;\n      }\n      if (config.uploadFileName) {\n        this.uploadFileName = config.uploadFileName;\n      }\n    }\n  }\n\n  render(){\n    this.root = document.createElement('div');\n    this.root.classList.add(this.rootClass);\n    this.root.classList.add('cdx-block');\n    this.redraw();\n    return this.root;\n  }\n\n  async handleFileUpload(e) {\n    if (e.target.files[0]) {\n      let fd = new FormData();\n      fd.append(this.uploadFileName, e.target.files[0])\n\n      let data = await fetch(this.endpoint, {\n        method: 'POST',\n        headers: this.headers,\n        body: fd\n      }).then((res) => res.json());\n      return data.file\n    }\n  }\n\n  redraw() {\n    let videoLabel = `<label class=\"${this.rootClass}__upload cdx-button ${this.videoLoading ? 'ctx-loader' : ''}\">\n      <input type=\"file\" class=\"${this.rootClass}__hidden\" accept=\"video/*\" />\n      <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" width=\"20\" height=\"20\"><path fill=\"none\" d=\"M0 0h24v24H0z\"/><path d=\"M3 3.993C3 3.445 3.445 3 3.993 3h16.014c.548 0 .993.445.993.993v16.014a.994.994 0 0 1-.993.993H3.993A.994.994 0 0 1 3 20.007V3.993zM5 5v14h14V5H5zm5.622 3.415l4.879 3.252a.4.4 0 0 1 0 .666l-4.88 3.252a.4.4 0 0 1-.621-.332V8.747a.4.4 0 0 1 .622-.332z\"/></svg>\n      <span>Добавить видео</span>\n    </label>`;\n    let videoPlayer = `<div class=\"${this.rootClass}__video\">\n      <video controls src=\"${this.video}\"></video>\n      <button type=\"button\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" width=\"24\" height=\"24\"><path fill=\"none\" d=\"M0 0h24v24H0z\"/><path d=\"M12 10.586l4.95-4.95 1.414 1.414-4.95 4.95 4.95 4.95-1.414 1.414-4.95-4.95-4.95 4.95-1.414-1.414 4.95-4.95-4.95-4.95L7.05 5.636z\"/></svg></button>\n    </div>`;\n\n    this.root.innerHTML = `<div class=\"${this.rootClass}__video\">${this.video ? videoPlayer : videoLabel}</div>\n      <input type=\"text\" placeholder=\"Название видео\" class=\"cdx-input ${this.rootClass}__title\" />`\n\n    let titleInput = this.root.querySelector(`.${this.rootClass}__title`);\n    titleInput.value = this.title || '';\n    this.api.listeners.on(titleInput, 'input', (e) => {\n      this.title = e.target.value;\n    }, false);\n\n    if (this.video) {\n      this.api.listeners.on(this.root.querySelector(`.${this.rootClass}__video button`), 'click', () => {\n        if (confirm(\"Вы уверены?\")) {\n          this.video = null;\n          this.redraw();\n        }\n      }, false);\n    } else {\n      this.api.listeners.on(this.root.querySelector(`.${this.rootClass}__upload input`), 'input', (e) => {\n        this.videoLoading = true;\n        this.handleFileUpload(e).then((file) => {\n          this.video = file;\n        }).catch((e) => {\n          console.error(e.message)\n        }).finally(() => {\n          this.videoLoading = false;\n          this.redraw();\n        })\n      }, false);\n    }\n\n  }\n\n  save(){\n    return {\n      title: this.title,\n      video: this.video,\n    };\n  }\n\n  static get toolbox() {\n    return {\n      title: 'Видео',\n      icon: '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" width=\"24\" height=\"24\"><path fill=\"none\" d=\"M0 0h24v24H0z\"/><path d=\"M3 3.993C3 3.445 3.445 3 3.993 3h16.014c.548 0 .993.445.993.993v16.014a.994.994 0 0 1-.993.993H3.993A.994.994 0 0 1 3 20.007V3.993zM5 5v14h14V5H5zm5.622 3.415l4.879 3.252a.4.4 0 0 1 0 .666l-4.88 3.252a.4.4 0 0 1-.621-.332V8.747a.4.4 0 0 1 .622-.332z\"/></svg>'\n    };\n  }\n}"],"names":["e","t","n","r","document","a","s","prepend","d","singleTag","i","container","querySelector","getElementsByTagName","u","indexOf","push","c","charCodeAt","substring","styleSheet","cssText","appendChild","createTextNode","createElement","setAttribute","attributes","Object","keys","length","insertAdjacentElement","Video","rootClass","title","video","headers","uploadFileName","videoLoading","endpoint","constructor","data","api","config","this","render","root","classList","add","redraw","async","target","files","fd","FormData","append","fetch","method","body","then","res","json","file","videoLabel","videoPlayer","innerHTML","titleInput","value","listeners","on","confirm","handleFileUpload","catch","console","error","message","finally","save","toolbox","icon"],"mappings":"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"}